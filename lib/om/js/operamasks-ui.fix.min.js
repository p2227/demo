(function(a){a.omWidget("om.omGrid",{options:{height:462,width:"100%",colModel:false,autoFit:false,showIndex:true,dataSource:false,extraData:{},method:"GET",preProcess:false,limit:15,rowClasses:["oddRow","evenRow"],singleSelect:true,title:"",onRowSelect:function(d,c,b){},onRowDeselect:function(d,c,b){},onRowClick:function(d,c,b){},onRowDblClick:function(d,c,b){},onPageChange:function(c,b,d){},onSuccess:function(e,b,d,c){},onError:function(c,e,d,b){},onRefresh:function(d,b,c){},_onRefreshCallbacks:[],_onResizableCallbacks:[],_onResizeCallbacks:[]},_create:function(){var b=this.options,d=this.element.show().attr({cellPadding:0,cellSpacing:0,border:0}).empty().append("<tbody></tbody>");d.wrap('<div class="om-grid om-widget om-widget-content"><div class="bDiv" style="width:auto"></div></div>').closest(".om-grid");if(!a.isArray(this._getColModel())){return}this.hDiv=a('<div class="hDiv om-state-default"></div>').append('<div class="hDivBox"><table cellPadding="0" cellSpacing="0"></table></div>');d.parent().before(this.hDiv);this.pDiv=a('<div class="pDiv om-state-default"></div>');d.parent().after(this.pDiv);var c=d.closest(".om-grid");this.loadMask=a('<div class="gBlock"><div align="center" class="gBlock-valignMiddle" ><div class="loadingImg" style="display:block"/></div></div>').mousedown(function(f){return false}).hide();c.append(this.loadMask);this.titleDiv=a("<div class='titleDiv'></div>");c.prepend(this.titleDiv);this.tbody=this.element.children().eq(0);this._guid=0;b._onRefreshCallbacks.push(function(){this._refreshHeaderCheckBox()});this._bindScrollEnvent()},_init:function(){var c=this.element,d=this.options,b=c.closest(".om-grid");this._measure(b,d);if(!a.isArray(this._getColModel())){return}this._extraData={};this.tbody.empty();a("table",this.hDiv).empty();this.pDiv.empty();this.titleDiv.empty();this._buildTableHead();this._buildPagingToolBar();this._buildLoadMask();this._bindSelectAndClickEnvent();this._makeColsResizable();this._buildTitle();this._resetHeight();this.pageData={nowPage:1,totalPages:1};this._populate()},resize:function(d){var e=this,g=this.options,c=this.element.closest(".om-grid"),f,b;d=d||{};g.width=d.width||arguments[0]||g.width;g.height=d.height||arguments[1]||g.height;this._measure(c,g);this._buildLoadMask();this._resetWidth();this._resetHeight();a.each(g._onResizeCallbacks,function(h,i){i.call(e)})},_measure:function(b,c){b.outerWidth(c.width==="fit"?b.parent().width():c.width);b.outerHeight(c.height==="fit"?b.parent().height():c.height)},_resetHeight:function(){var e=this.element,b=e.closest(".om-grid");var c=this.hDiv.outerHeight(true),d=this.pDiv.is(":hidden")?0:this.pDiv.outerHeight(true),f=this.titleDiv.is(":hidden")?0:this.titleDiv.outerHeight(true);b.children(".bDiv").outerHeight(b.height()-c-d-f)},_resetWidth:function(){var g=this.options,e=this._getColModel(),c=-1,b=this.element.closest(".om-grid"),f=a("thead",this.hDiv),h=0;a.each(e,function(j,i){var k=i.width||60;if(i.width=="autoExpand"){k=0;c=j}f.find("th[axis='col"+j+"'] >div").width(k);h+=k});this._fixHeaderWidth(c,h);var d={};a(this._getHeaderCols()).each(function(){d[a(this).attr("abbr")]=a("div",a(this)).width()});this.tbody.find("td[abbr]").each(function(j,k){var i=a(k).prop("abbr");if(d[i]!=null){a(k).find(">div:first").width(d[i])}})},_getColModel:function(){return this.options.colModel},_buildTitle:function(){var b=this.titleDiv;if(this.options.title){b.html("<div class='titleContent'>"+this.options.title+"</div>").show()}else{b.empty().hide()}},_fixHeaderWidth:function(c,k){var l=this.element.closest(".om-grid"),i=a("thead",this.hDiv),j=this._getColModel(),d=this.options;if(c!=-1){var g=l.width()-32,e=i.find('th[axis="col'+c+'"] div');e.parent().hide();var f=g-i.width();e.parent().show();if(f<=0){e.css("width",60)}else{e.css("width",f)}}else{if(d.autoFit){var g=l.width()-22,f=g-i.width(),h=1+f/k,b=i.find('th[axis^="col"] >div');a.each(j,function(m){var n=b.eq(m);n.width(parseInt(n.width()*h))})}}},_buildTableHead:function(){var j=this.options,f=this.element,b=f.closest(".om-grid"),m=this._getColModel(),p=0,g=0,r=0,d=-1;thead=a("<thead></thead>");tr=a("<tr></tr>").appendTo(thead);if(j.showIndex){var q=a("<th></th>").attr({axis:"indexCol",align:"center"}).addClass("indexCol").append(a('<div class="indexheader" style="text-align:center;width:25px;"></div>'));tr.append(q);g=25}if(!j.singleSelect){var q=a("<th></th>").attr({axis:"checkboxCol",align:"center"}).addClass("checkboxCol").append(a('<div class="checkboxheader" style="text-align:center;width:17px;"><span class="checkbox"/></div>'));tr.append(q);r=17}for(var h=0,l=m.length;h<l;h++){var o=m[h],c=o.width||60,k=o.align||"center";if(c=="autoExpand"){c=0;d=h}var n=a("<div></div>").html(o.header).css({"text-align":k,width:c});o.wrap&&n.addClass("wrap");var e=a("<th></th>").attr("axis","col"+h).addClass("col"+h).append(n);if(o.name){e.attr("abbr",o.name)}if(o.align){e.attr("align",o.align)}p+=c;tr.append(e)}f.prepend(thead);a("table",this.hDiv).append(thead);this._fixHeaderWidth(d,p);this.thead=thead;thead=null},_buildPagingToolBar:function(){var f=this.options;if(f.limit<=0){this.pDiv.css("border-width",0).hide();this.pager=this.pDiv;return}var c=this,d=this.element,b=this.pDiv;b.show().html('<div class="pDiv2"><div class="pGroup"><div class="pFirst pButton om-icon"><span class="om-icon-seek-start"></span></div><div class="pPrev pButton om-icon"><span class="om-icon-seek-prev"></span></div></div><div class="btnseparator"></div><div class="pGroup"><span class="pControl"></span></div><div class="btnseparator"></div><div class="pGroup"><div class="pNext pButton om-icon"><span class="om-icon-seek-next"></span></div><div class="pLast pButton om-icon"><span class="om-icon-seek-end"></span></div></div><div class="btnseparator"></div><div class="pGroup"><div class="pReload pButton om-icon"><span class="om-icon-refresh"></span></div></div><div class="btnseparator"></div><div class="pGroup"><span class="pPageStat"></span></div></div>');var e=a.om.lang._get(f,"omGrid","pageText").replace(/{totalPage}/,"<span>1</span>").replace(/{index}/,'<input type="text" size="4" value="1" />');a(".pControl",b).html(e);d.parent().after(b);a(".pReload",b).click(function(){c._populate()});a(".pFirst",b).click(function(){c._changePage("first")});a(".pPrev",b).click(function(){c._changePage("prev")});a(".pNext",b).click(function(){c._changePage("next")});a(".pLast",b).click(function(){c._changePage("last")});a(".pControl input",b).keydown(function(g){if(g.keyCode==a.om.keyCode.ENTER){c._changePage("input")}});a(".pButton",b).hover(function(){a(this).addClass("om-state-hover")},function(){a(this).removeClass("om-state-hover")});this.pager=b},_buildLoadMask:function(){var b=this.element.closest(".om-grid");this.loadMask.css({width:"100%",height:b.height()})},_changePage:function(c){if(this.loading){return true}var e=this.element,h=this.options,b=e.closest(".om-grid"),d=this.pageData,g=d.nowPage,i=d.totalPages,f=g;this._oldPage=g;switch(c){case"first":f=1;break;case"prev":if(g>1){f=g-1}break;case"next":if(g<i){f=g+1}break;case"last":f=i;break;case"input":var j=parseInt(a(".pControl input",e.closest(".om-grid")).val());if(isNaN(j)){j=g}if(j<1){j=1}else{if(j>i){j=i}}a(".pControl input",this.pDiv).val(j);f=j;break;default:if(/\d/.test(c)){var j=parseInt(c);if(isNaN(j)){j=1}if(j<1){j=1}else{if(j>i){j=i}}a(".pControl input",e.closest(".om-grid")).val(j);f=j}}if(f==g){return false}if(this._trigger("onPageChange",null,c,f)===false){return}d.nowPage=f;this._populate()},_populate:function(){var l=this,f=this.element,b=f.closest(".om-grid"),j=this.options,e=a(".pPageStat",b);if(!j.dataSource){a(".pPageStat",b).html(j.emptygMsg);return false}if(this.loading){return true}var d=this.pageData,h=d.nowPage||1,c=a(".gBlock",b);this.loading=true;e.html(a.om.lang._get(j,"omGrid","loadingMsg"));c.show();var k=function(p,r,o){var q=j.onSuccess;if(typeof(q)=="function"){l._trigger("onSuccess",null,p,r,o)}l._addData(p);for(var n=0,m=j._onRefreshCallbacks.length;n<m;n++){j._onRefreshCallbacks[n].call(l)}l._trigger("onRefresh",null,h,p.rows);c.hide();l.loading=false};if(typeof j.dataSource==="string"){var i=(j.limit<=0)?100000000:j.limit;var g=a.extend(true,{},this._extraData,j.extraData,{start:i*(h-1),limit:i,_time_stamp_:new Date().getTime()});a.ajax({type:j.method,url:j.dataSource,data:g,dataType:"json",success:k,error:function(n,q,p){e.html(a.om.lang._get(j,"omGrid","errorMsg")).css("color","red");try{var m=j.onError;if(typeof(m)=="function"){m(n,q,p)}}catch(o){}finally{c.hide();l.loading=false;l.pageData.data={rows:[],total:0};return false}}})}else{k(j.dataSource)}},_addData:function(g){var h=this.options,f=this.element,e=f.closest(".om-grid"),b=a(".pPageStat",e),d=h.preProcess,c=this.pageData;d&&(g=d(g));c.data=g;c.totalPages=Math.ceil(g.total/h.limit);this._buildPager();this._renderDatas()},_buildPager:function(){var i=this.options;if(i.limit<=0){return}var e=this.element,g=this.pager,b=a(".pControl",g),d=this.pageData,f=d.nowPage,j=d.totalPages,h=d.data,l=i.limit*(f-1)+1,k=l-1+h.rows.length,c="";if(h.total===0){c=a.om.lang._get(i,"omGrid","emptyMsg")}else{c=a.om.lang._get(i,"omGrid","pageStat").replace(/{from}/,l).replace(/{to}/,k).replace(/{total}/,h.total)}a("input",b).val(f);a("span",b).html(j);a(".pPageStat",g).html(c)},_renderDatas:function(){var r=this,f=this.element,l=this.options,c=f.closest(".om-grid"),n=this._getHeaderCols(),s=this.pageData.data.rows||[],o=this._getColModel(),h=l.rowClasses,k=a("tbody",f).empty(),b=(typeof h==="function"),e=this.pageData,d=(e.nowPage-1)*l.limit,g="<td align='$' abbr='$' class='$'><div align='$' class='innerCol $' style='width:$px'>$</div></td>",q=[],p=[],m,i;if(!this.pageData.data.rows){this.pageData.data.rows=[]}r.hDiv.scrollLeft(0);a(n).each(function(j){q[j]=a("div",a(this)).width()});a.each(s,function(j,u){var t=b?h(j,u):h[j%h.length];var v=r._buildRowCellValues(o,u,j);p.push("<tr _grid_row_id="+(r._guid++)+" class='om-grid-row "+t+"'>");a(n).each(function(x){var A=a(this).attr("axis"),z=false,y;if(A=="indexCol"){y=j+d+1}else{if(A=="checkboxCol"){y='<span class="checkbox"/>'}else{if(A.substring(0,3)=="col"){var w=A.substring(3);y=v[w];if(o[w].wrap){z=true}}else{y=""}}}m=[this.align,this.abbr,A,this.align,z?"wrap":"",q[x],y];i=0;p.push(g.replace(/\$/g,function(){return m[i++]}))});p.push("</tr>")});k.html(p.join(" "))},_getHeaderCols:function(){return this.hDiv.find("th[axis]")},_buildRowCellValues:function(n,e,m){var h=n.length,o=[];for(var g=0;g<h;g++){var l=n[g],p,b=l.renderer;if(l.name.indexOf(".")>0){var k=l.name.split("."),f=1,d=k.length,p=e[k[0]];while(f<d&&p&&(p=p[k[f++]])!=undefined){}}if(p==undefined){p=e[l.name]==undefined?"":e[l.name]}if(typeof b==="function"){p=b(p,e,m)}o[g]=p;p=null}return o},_bindScrollEnvent:function(){var b=this;this.tbody.closest(".bDiv").scroll(function(){b.hDiv.scrollLeft(a(this).scrollLeft())})},_bindSelectAndClickEnvent:function(){var b=this;this.tbody.unbind();if(!this.options.singleSelect){a("th.checkboxCol span.checkbox",this.thead).click(function(){var e=a(this),d=b._getTrs().size();if(e.hasClass("selected")){e.removeClass("selected");for(var c=0;c<d;c++){b._rowDeSelect(c)}}else{e.addClass("selected");for(var c=0;c<d;c++){b._rowSelect(c)}}});this.tbody.delegate("tr.om-grid-row","click",function(d){var e=a(this),c=b._getRowIndex(e);if(e.hasClass("om-state-highlight")){b._rowDeSelect(c)}else{b._rowSelect(c)}b._refreshHeaderCheckBox();b._trigger("onRowClick",d,c,b._getRowData(c))});this.tbody.delegate("tr.om-grid-row","dblclick",function(d){var e=a(this),c=b._getRowIndex(e);if(e.hasClass("om-state-highlight")){}else{b._rowSelect(c);b._refreshHeaderCheckBox()}b._trigger("onRowDblClick",d,c,b._getRowData(c))})}else{this.tbody.delegate("tr.om-grid-row","click",function(d){var f=a(this),c=b._getRowIndex(f);if(f.hasClass("om-state-highlight")){}else{var e=b._getRowIndex(b.tbody.find("tr.om-state-highlight:not(:hidden)"));(e!=-1)&&b._rowDeSelect(e);b._rowSelect(c)}b._trigger("onRowClick",d,c,b._getRowData(c))});this.tbody.delegate("tr.om-grid-row","dblclick",function(d){var c=b._getRowIndex(this);b._trigger("onRowDblClick",d,c,b._getRowData(c))})}},_getRowData:function(b){return this.pageData.data.rows[b]},_rowSelect:function(d){var e=this.element,g=this.options,c=a("tbody",e),f=this._getTrs().eq(d),b=a("td.checkboxCol span.checkbox",f);f.addClass("om-state-highlight");b.addClass("selected");this._trigger("onRowSelect",null,d,this._getRowData(d))},_rowDeSelect:function(d){var e=this.element,g=this.options,c=a("tbody",e),f=this._getTrs().eq(d),b=a("td.checkboxCol span.checkbox",f);f.removeClass("om-state-highlight");b.removeClass("selected");this._trigger("onRowDeselect",null,d,this._getRowData(d))},_refreshHeaderCheckBox:function(){var e=this.getSelections(),d=this._getTrs(),c=a("th.checkboxCol span.checkbox",this.thead),b=d.length;c.toggleClass("selected",b>0&&b==e.length)},_makeColsResizable:function(){var b=this,e=b.tbody.closest(".bDiv"),d=b.element.closest(".om-grid"),c=this.titleDiv,f;a('th[axis^="col"] div',b.thead).omResizable({handles:"e",containment:"document",minWidth:60,resize:function(k,j){var l=a(this),h=l.parent().attr("abbr"),i=a('td[abbr="'+h+'"] > div',b.tbody),g=b.thead.closest(".hDiv");l.width(k.size.width).height("");i.width(k.size.width).height("");e.height(d.height()-(c.is(":hidden")?0:c.outerHeight(true))-g.outerHeight(true)-(b.pDiv.is(":hidden")?0:b.pDiv.outerHeight(true)));g.scrollLeft(e.scrollLeft())},start:function(h,g){f=a(this).parent().width()},stop:function(n,m){var l=b.options._onResizableCallbacks,k=a(this).parent(),h=b.thead.closest(".hDiv");f=k.width()-f;for(var j=0,g=l.length;j<g;j++){l[j].call(b,k,f)}h.scrollLeft(e.scrollLeft())}})},_getRowIndex:function(b){return this._getTrs().index(b)},_getTrs:function(){return this.tbody.find("tr.om-grid-row:not([_delete]=true)")},setData:function(b){this.options.dataSource=b;this.pageData={nowPage:1,totalPages:1};this._populate()},getData:function(){return this.pageData.data},refresh:function(){if(this.loading){return true}this.loading=true;var d=this.options;a(".pPageStat",this.pager).html(a.om.lang._get(d,"omGrid","loadingMsg"));this.loadMask.show();this._buildPager();this._renderDatas();this._trigger("onRefresh",null,this.pageData.nowPage||1,this.pageData.data.rows);for(var c=0,b=d._onRefreshCallbacks.length;c<b;c++){d._onRefreshCallbacks[c].call(this)}this.loadMask.hide();this.loading=false},reload:function(b){if(this.loading){return true}if(typeof b!=="undefined"){b=parseInt(b)||1;if(b<0){b=1}if(b>this.pageData.totalPages){b=this.pageData.totalPages}this.pageData.nowPage=b}this._populate()},setSelections:function(c){var b=this;if(!a.isArray(c)){c=[c]}var d=this.getSelections();a(d).each(function(){b._rowDeSelect(this)});a(c).each(function(){b._rowSelect(this)});b._refreshHeaderCheckBox()},getSelections:function(c){var f=this,e=f._getTrs(),g=e.filter(".om-state-highlight"),b=[];if(c){var d=f.getData().rows;g.each(function(h,i){b[b.length]=d[e.index(i)]})}else{g.each(function(h,i){b[b.length]=e.index(i)})}return b},destroy:function(){var b=this.element;b.closest(".om-grid").after(b).remove()}});a.om.lang.omGrid={loadingMsg:"正在加载数据，请稍候...",emptyMsg:"没有数据",errorMsg:"取数出错",pageText:"第{index}页，共{totalPage}页",pageStat:"共{total}条数据，显示{from}-{to}条"}})(jQuery);(function(a){if(!Array.prototype.indexOf){Array.prototype.indexOf=function(d){var b=this.length;for(var c=0;c<b;c++){if(this[c]===d){return c}}return -1}}a.omWidget("om.omCombo",{options:{optionField:"text",valueField:"value",width:"auto",disabled:false,readOnly:false,editable:true,lazyLoad:false,listMaxHeight:300,listAutoWidth:false,autoFilter:true,filterStrategy:"first",filterDelay:500,forceSelection:false,multi:false,multiSeparator:","},_init:function(){var b=this.options,e=this.textInput,d=b.dataSource;if(!b.inputField){b.inputField=b.optionField}if(typeof b.value!=="undefined"){b.lazyLoad=false}if(b.width!="auto"){var c=e.parent().width(b.width);e.width(c.innerWidth()-e.next().outerWidth()-e.outerWidth()+e.width())}if(b.multi){b.editable=this.options.editable=false}this._refeshEmptyText(b.emptyText);b.disabled?e.attr("disabled",true):e.removeAttr("disabled");(b.readOnly||!b.editable)?e.attr("readonly","readOnly"):e.removeAttr("readonly");if(!b.lazyLoad){this._toggleLoading("add");if(d&&typeof d=="string"){this._ajaxLoad(d)}else{if(d&&typeof d=="object"){this._loadData(d);this._toggleLoading("remove")}else{this.dataHasLoaded=true;this._toggleLoading("remove")}}}else{this.dataHasLoaded=false}var f=b.disabled||b.readOnly;if(f){this.expandTrigger.addClass("om-state-disabled")}else{this._bindEvent()}},_create:function(){var c=this.element;var b=a('<span class="om-combo om-widget om-state-default"></span>').insertAfter(c).wrapInner(c);this.textInput=c.clone().removeAttr("id").removeAttr("name").appendTo(b);this.expandTrigger=a('<span class="om-combo-trigger"></span>').appendTo(b);c.hide();this.dropList=a(a('<div class="om-widget"><div class="om-widget-content om-droplist"></div></div>').css({position:"absolute",zIndex:2000}).appendTo(document.body).children()[0]).hide()},setData:function(e){var b=this,d=b.textInput,c=b.element;b.options.value="";c.val("");d.val("");b._toggleLoading("add");if(typeof e==="string"){b._ajaxLoad(e)}else{b._loadData(e);b._toggleLoading("remove")}},getData:function(){var b=this.options.dataSource;return(typeof b=="object")?b:null},value:function(b){if(typeof b==="undefined"){var c=this.element.val();return c?c:""}else{this._setValue(b+"");return this}},disable:function(){var b=this.element;b.attr("disabled",true).unbind();this.options.disabled=true;this.expandTrigger.addClass("om-state-disabled").unbind()},enable:function(){var b=this.element;b.removeAttr("disabled").unbind();this.options.disabled=false;this.expandTrigger.removeClass("om-state-disabled").unbind();this._bindEvent()},destroy:function(){var b=this.element;a(document).unbind("mousedown.omCombo",this.globalEvent);b.parent().after(b).remove();this.dropList.parent().remove()},getText:function(){return this.textInput?this.textInput.val():""},_bindEvent:function(){var i=this,j=i.options,e=i.textInput,c=i.element,b=i.dropList,g=i.expandTrigger,d=j.emptyText;var h=false,f=e.parent("span");f.mouseenter(function(){if(!j.disabled){f.addClass("om-state-hover")}}).mouseleave(function(){f.removeClass("om-state-hover")}).mousedown(function(k){k.stopPropagation()});e.focus(function(){if(h){return}h=true;a(".om-droplist").hide();f.addClass("om-state-focus");i._refeshEmptyText(d);if(!i.dataHasLoaded){if(!g.hasClass("om-loading")){i._toggleLoading("add");if(typeof(j.dataSource)=="object"){i._loadData(j.dataSource);i._toggleLoading("remove")}else{if(typeof(j.dataSource)=="string"){i._ajaxLoad(j.dataSource)}else{i.dataHasLoaded=true;i._toggleLoading("remove")}}}}if(!j.disabled&&!j.readOnly){i._showDropList()}}).blur(function(n){h=false;f.removeClass("om-state-focus");e.removeClass("om-combo-focus");if(!j.disabled&&!j.readOnly&&!j.multi){if(i.hasManualInput){i.hasManualInput=false;var o=e.val();if(o!==""){var p=a.data(c,"allInputText");var k=a.data(c,"allValues");var l=p.indexOf(o);if(l>-1){i._setValue(k[l])}else{if(!j.forceSelection){c.val(e.val())}else{var m=c.val();l=k.indexOf(m);if(l>-1){e.val(p[l])}else{e.val("")}}}}else{c.val("")}}i._refeshEmptyText(d)}}).keyup(function(m){var k=m.keyCode,l=a.om.keyCode;switch(k){case l.DOWN:i._selectNext();break;case l.UP:i._selectPrev();break;case l.ENTER:i._backfill(i.dropList.find(".om-state-hover"));break;case l.ESCAPE:b.hide();break;case l.TAB:break;default:i.hasManualInput=true;if(!j.disabled&&!j.readOnly&&j.editable&&j.autoFilter){if(window._omcomboFilterTimer){clearTimeout(window._omcomboFilterTimer)}window._omcomboFilterTimer=setTimeout(function(){if(a(document).attr("activeElement").id==e.attr("id")){b.show()}i._doFilter(e)},j.filterDelay)}}});b.mousedown(function(k){k.stopPropagation()});g.click(function(){!g.hasClass("om-loading")&&e.focus()}).mousedown(function(){!g.hasClass("om-loading")&&f.addClass("om-state-active")}).mouseup(function(){!g.hasClass("om-loading")&&f.removeClass("om-state-active")});a(document).bind("mousedown.omCombo",this.globalEvent=function(){b.hide()})},_showDropList:function(){var q=this,s=q.options,n=q.textInput,p=q.element,b=q.dropList.scrollTop(0).css("height","auto"),r,e=p.val(),k=b.find(".om-combo-list-row"),h=q._getAllOptionsBeforeFiltered().removeClass("om-helper-hidden om-state-hover");if(h.size()<=0){return}k.removeClass("om-combo-selected");if(e!==undefined&&e!==""){var c=a.data(p,"allValues");if(s.multi){var j=e.split(s.multiSeparator);for(var d=0;d<j.length;d++){var f=c.indexOf(j[d]);if(f>-1){a(b.find(".om-combo-list-row").get(f)).addClass("om-combo-selected")}}valueItem=j[0]}else{var f=c?c.indexOf(e):-1;if(f>-1){r=a(b.find(".om-combo-list-row").get(f)).addClass("om-combo-selected")}}}var m=b.parent(),l=n.parent();if(!s.listAutoWidth){m.width(l.outerWidth())}else{if(a.browser.msie&&(a.browser.version=="7.0")&&!a.support.style){m.width(b.show().outerWidth())}else{m.width(b.outerWidth())}}if(s.listMaxHeight!="auto"&&b.show().height()>s.listMaxHeight){b.height(s.listMaxHeight).css("overflow-y","auto")}var g=l.offset();var o=g.top+l.outerHeight();o=o+b.show().height()>(document.body.clientHeight-10)?g.top-b.show().outerHeight():o;m.css({left:g.left,top:o});b.show();if(r){b.scrollTop(a(r).offset().top-b.offset().top)}},_toggleLoading:function(b){if(!this.options.disabled){if(b=="add"){this.expandTrigger.removeClass("om-icon-carat-1-s").addClass("om-loading")}else{if(b=="remove"){this.expandTrigger.removeClass("om-loading").addClass("om-icon-carat-1-s")}}}},_ajaxLoad:function(d){var b=this;var c=this.options;a.ajax({url:d,method:"POST",dataType:"json",success:function(e,g){b.dataHasLoaded=true;var f=c.onSuccess;if(f&&b._trigger("onSuccess",null,e,g)===false){c.dataSource=e;return}b._loadData(e);b._toggleLoading("remove")},error:function(e,g,f){b.dataHasLoaded=true;if(c.onError){b._toggleLoading("remove");b._trigger("onError",null,e,g,f)}else{b._toggleLoading("remove");throw new Error('An error occurred while load records from URL "'+d+'",the error message is:'+f.message)}}})},_loadData:function(g){var m=this.options,e=this.element;m.dataSource=g;this.dataHasLoaded=true;var f=m.inputField;var h=[];if(typeof f==="string"){a(g).each(function(){h.push(this[f])})}else{a(g).each(function(n){h.push(f(this,n))})}a.data(e,"allInputText",h);var l=m.valueField;var c=[];if(typeof l==="string"){a(g).each(function(){c.push(""+this[l])})}else{a(g).each(function(n){c.push(""+l(this,n))})}a.data(e,"allValues",c);var b=this.dropList.empty();if(m.listProvider){var j=m.listProvider(b,g);if(j){j.each(function(){a(this).addClass("om-combo-list-row")})}}else{var i=m.optionField;var d="";var k=this;if(typeof i==="string"){a(g).each(function(n){d+=k._wrapText(this[m.optionField])})}else{a(g).each(function(n){d+=k._wrapText(m.optionField(this,n))})}if(d){a(d).appendTo(b);b.show().css("height","auto");if(m.listMaxHeight!="auto"&&b.height()>m.listMaxHeight){b.height(m.listMaxHeight).css("overflow-y","auto")}b.hide();if(e.parent().hasClass("om-state-hover")){k._showDropList()}}}if(m.value){this._setValue(""+m.value)}this._bindEventsToList()},_bindEventsToList:function(){var c=this,b=c._getAllOptionsBeforeFiltered();b.hover(function(){b.removeClass("om-state-hover");a(this).addClass("om-state-hover")},function(){a(this).removeClass("om-state-hover")}).mousedown(function(){c._backfill(this)})},_wrapText:function(b){return'<div class="om-combo-list-row">'+b+"</div>"},_setValue:function(k){var j=this.textInput,d=this.element;var f=true;var b=d.val();var m=this.options;if(k==b){f=false}var c=a.data(d,"allValues");var g=[],l=[];if(m.multi){l=k.split(m.multiSeparator)}else{l.push(k)}for(var e=0;e<l.length;e++){var h=c?c.indexOf(l[e]):-1;if(h>-1){g.push(a.data(d,"allInputText")[h])}else{if(!m.forceSelection){g.push(k)}else{d.val("");k=""}}}d.val(k);if(m.multi){j.val(g.join(m.multiSeparator))}else{j.val(g.join(""))}m.value=k;if(m.onValueChange&&f){this._trigger("onValueChange",null,j,k,b)}this._refeshEmptyText(m.emptyText)},_findHighlightItem:function(){var b=this.dropList;var c=b.find(".om-state-hover");if(c.length>0){return c}var d=b.find(".om-combo-selected");return d.length>0?d[0]:d},_selectPrev:function(){var b=this._findHighlightItem();var d=this._getAllOptionsAfterFiltered();var f=d.index(b);var c=a(d[f]);if(f===0){f=d.length}else{if(f==-1){f=d.length}}var e=a(d[f-1]);this._highLisghtAndScrollTo(c,e)},_selectNext:function(){var d=this.dropList;if(d.css("display")=="none"){this._showDropList();return}var e=this._getAllOptionsAfterFiltered();var f=e.index(this._findHighlightItem());var c=a(e[f]);if(f==e.length-1){f=-1}var b=a(e[f+1]);this._highLisghtAndScrollTo(c,b)},_highLisghtAndScrollTo:function(c,d){var b=this.dropList;c.removeClass("om-state-hover");d.addClass("om-state-hover");if(d.position().top<=0){b.scrollTop(b.scrollTop()+d.position().top)}else{if(d.position().top+d.outerHeight()>b.height()){b.scrollTop(b.scrollTop()+d.position().top+d.outerHeight()-b.height())}}},_backfill:function(b){if(b.length===0){return}var k=this,e=k.element,c=k.dropList,l=k.options,d=l.multi;if(d){a(b).toggleClass("om-combo-selected").removeClass("om-state-hover")}else{this._getAllOptionsBeforeFiltered().removeClass("om-combo-selected");a(b).addClass("om-combo-selected")}if(c.css("display")=="none"){return}var j=[],h=c.find(".om-combo-selected");for(var g=0;g<h.length;g++){var f=a(h[g]).index();if(f>-1){j.push(a.data(e,"allValues")[f])}}this._setValue(j.join(d?l.multiSeparator:""));if(!d){c.hide()}},_getAllOptionsBeforeFiltered:function(){return this.dropList.find(".om-combo-list-row")},_getAllOptionsAfterFiltered:function(){var b=this.dropList;return b.find(".om-combo-list-row").not(b.find(".om-helper-hidden"))},_doFilter:function(){var b=this,f=b.textInput,e=b.element,c=b.options;records=c.dataSource,filterStrategy=c.filterStrategy,text=f.val(),needShow=false,items=b._getAllOptionsBeforeFiltered(),allInputText=a.data(e,"allInputText");a(records).each(function(g){if(b._filetrPass(filterStrategy,text,records[g],allInputText[g])){a(items.get(g)).removeClass("om-helper-hidden");needShow=true}else{a(items.get(g)).addClass("om-helper-hidden")}});var d=this.dropList.css("height","auto");if(c.listMaxHeight!="auto"&&d.height()>c.listMaxHeight){d.height(c.listMaxHeight).css("overflow-y","auto")}if(!needShow){d.hide()}},_filetrPass:function(d,f,b,e){if(f===""){return true}if(typeof d==="function"){return d(f,b)}else{if(d==="first"){return e.indexOf(f)===0}else{if(d==="anywhere"){return e.indexOf(f)>-1}else{if(d==="last"){var c=e.lastIndexOf(f);return c>-1&&c+f.length==e.length}else{return false}}}}},_refeshEmptyText:function(b){var c=this.textInput;if(!b){return}if(c.val()===""){c.val(b).addClass("om-empty-text")}else{if(c.val()===b){c.val("")}c.removeClass("om-empty-text")}}})})(jQuery);(function(a){a.omWidget("om.omCalendar",{options:{date:new Date(),startDay:0,pages:1,minDate:false,maxDate:false,popup:true,showTime:false,onSelect:function(b,c){},disabledDays:[],disabledFn:function(b){},disabled:false,readOnly:false,editable:true,dateFormat:false},disable:function(){if(this.options.popup){this.hide();this.options.disabled=true;this.element.attr("disabled",true).unbind(".omCalendar").next().addClass("om-state-disabled").unbind()}},enable:function(){if(this.options.popup){this.options.disabled=false;this.element.attr("disabled",false).next().removeClass("om-state-disabled");this._buildStatusEvent()}},getDate:function(){return this.options.date},setDate:function(b){this.options.date=b;this._render({date:b})},_create:function(){var c=this.element,b=this.options;this.cid=this._stamp(c);if(b.popup){c.wrap("<span></span>").after('<span class="om-calendar-trigger"></span>').parent().addClass("om-calendar om-widget om-state-default");this.con=a("<div></div>").appendTo(document.body).css({top:"0px",position:"absolute",background:"white",visibility:"hidden","z-index":"2000"});this._buildBodyEvent();this._buildStatusEvent()}else{this.con=this.element}this.con.addClass("om-calendar-list-wrapper om-widget om-clearfix om-widget-content")},_init:function(){var c=this.element,b=this.options;this.con.addClass("multi-"+b.pages);this._buildParam();if(b.popup){c.val()&&(b.date=a.omCalendar.parseDate(c.val(),b.dateFormat||this._defaultFormat)||new Date())}this._render();if(b.readOnly||!b.editable){c.attr("readonly","readOnly").unbind()}else{c.removeAttr("readonly")}b.disabled?this.disable():this.enable()},_render:function(d){var g=0,b,e,h,k=this.element,c=this.options;this.ca=[];this._parseParam(d);this.con.html("");for(g=0,h=[this.year,this.month];g<c.pages;g++){if(g===0){b=true}else{b=false;h=this._computeNextMonth(h)}e=g==(c.pages-1);this.ca.push(new a.om.omCalendar.Page({year:h[0],month:h[1],prevArrow:b,nextArrow:e,showTime:self.showTime},this));this.ca[g]._render()}if(c.pages>1){var f=k.find(".om-cal-box");var j=[];a.each(f,function(l,m){j.push(a(m).css("height"))});j.sort();f.css("height",j[j.length-1])}},_stamp:function(b){if(b.attr("id")===undefined||b.attr("id")===""){b.attr("id","K_"+new Date().getTime())}return b.attr("id")},_buildStatusEvent:function(){var b=this;this.element.unbind(".omCalendar").bind("click.omCalendar",function(c){b.toggle()}).bind("focus.omCalendar",function(){a(this).parent().addClass("om-state-hover om-state-active")}).bind("blur.omCalendar",function(){a(this).parent().removeClass("om-state-hover om-state-active")}).next().unbind().click(function(){b.element.trigger("focus");b.show()}).mouseover(function(){a(this).parent().addClass("om-state-hover")}).mouseout(function(){!b.isVisible()&&a(this).parent().removeClass("om-state-hover")})},_buildBodyEvent:function(){var b=this;a(document).bind("mousedown.omCalendar",this.globalEvent=function(c){b.hide()});b.con.mousedown(function(c){c.stopPropagation()})},toggle:function(){if(!this.isVisible()){this.show()}else{this.hide()}},isVisible:function(){if(this.con.css("visibility")=="hidden"){return false}return true},show:function(){var e=this.element.parent();this.con.css("visibility","");var d=e.offset().left,b=e.offsetHeight||e.outerHeight(),c=e.offset().top+b;c=c+this.con.height()>(document.body.clientHeight-10)?e.offset().top-this.con.outerHeight():c;this.con.css("left",d.toString()+"px");this.con.css("top",c.toString()+"px")},hide:function(){this.con.css("visibility","hidden")},destroy:function(){var b=this.element;a("body").unbind(".omCalendar",this.globalEvent);if(this.options.popup){b.parent().after(b).remove();this.con.remove()}},_buildParam:function(){var b=this.options;b.startDay&&(b.startDay=(7-b.startDay)%7);!b.dateFormat&&(this._defaultFormat=b.showTime?"yy-mm-dd H:i:s":"yy-mm-dd");this.EV=[];return this},_parseParam:function(b){b&&a.extend(this.options,b);this._handleDate()},_templetShow:function(c,h){var e,j,d,b,g,f;if(h instanceof Array){e="";for(d=0;d<h.length;d++){e+=arguments.callee(c,h[d])}c=e}else{j=c.match(/{\$(.*?)}/g);if(h!==undefined&&j!==null){for(d=0,b=j.length;d<b;d++){f=j[d].replace(/({\$)|}/g,"");g=(h[f]!==undefined)?h[f]:"";c=c.replace(j[d],g)}}}return c},_handleDate:function(){var b=this.options.date;this.day=b.getDate();this.month=b.getMonth();this.year=b.getFullYear()},_getHeadStr:function(b,c){return b.toString()+a.om.lang.omCalendar.year+(Number(c)+1).toString()+a.om.lang.omCalendar.month},_monthAdd:function(){var b=this;if(b.month==11){b.year++;b.month=0}else{b.month++}b.options.date.setFullYear(b.year,b.month,1);return this},_monthMinus:function(){var b=this;if(b.month===0){b.year--;b.month=11}else{b.month--}b.options.date.setFullYear(b.year,b.month,1);return this},_computeNextMonth:function(b){var d=b[0],c=b[1];if(c==11){d++;c=0}else{c++}return[d,c]},_handleOffset:function(){var d=this,g=a.om.lang.omCalendar,f=[g.Su,g.Mo,g.Tu,g.We,g.Th,g.Fr,g.Sa],c="<span>{$day}</span>",j=this.options.startDay,h="",b=[];for(var e=0;e<7;e++){b[e]={day:f[(e-j+7)%7]}}h=d._templetShow(c,b);return{day_html:h}}});a.extend(a.om.omCalendar,{Page:function(c,b){var d=a.om.lang.omCalendar;this.father=b;this.month=Number(c.month);this.year=Number(c.year);this.prevArrow=c.prevArrow;this.nextArrow=c.nextArrow;this.node=null;this.timmer=null;this.id="";this.EV=[];this.html=['<div class="om-cal-box" id="{$id}">','<div class="om-cal-hd om-widget-header">','<a href="javascript:void(0);" class="om-prev {$prev}"><span class="om-icon om-icon-seek-prev">Prev</span></a>','<a href="javascript:void(0);" class="om-title">{$title}</a>','<a href="javascript:void(0);" class="om-next {$next}"><span class="om-icon om-icon-seek-next">Next</span></a>',"</div>",'<div class="om-cal-bd">','<div class="om-whd">',b._handleOffset().day_html,"</div>",'<div class="om-dbd om-clearfix">',"{$ds}","</div>","</div>",'<div class="om-setime om-state-default hidden">',"</div>",'<div class="om-cal-ft {$showtime}">','<div class="om-cal-time om-state-default">',"时间：00:00 &hearts;","</div>","</div>",'<div class="om-selectime om-state-default hidden">',"</div>","</div><!--#om-cal-box-->"].join("");this.nav_html=["<p>",d.month,'<select value="{$the_month}">','<option class="m1" value="1">01</option>','<option class="m2" value="2">02</option>','<option class="m3" value="3">03</option>','<option class="m4" value="4">04</option>','<option class="m5" value="5">05</option>','<option class="m6" value="6">06</option>','<option class="m7" value="7">07</option>','<option class="m8" value="8">08</option>','<option class="m9" value="9">09</option>','<option class="m10" value="10">10</option>','<option class="m11" value="11">11</option>','<option class="m12" value="12">12</option>',"</select>","</p>","<p>",d.year,'<input type="text" value="{$the_year}" onfocus="this.select()"/>',"</p>","<p>",'<button class="ok">',d.ok,'</button><button class="cancel">',d.cancel,"</button>","</p>"].join("");this.Verify=function(){var f=function(h){if(!/^\d+$/i.test(h)){return false}h=Number(h);return !(h<1||h>31)},e=function(h){if(!/^\d+$/i.test(h)){return false}h=Number(h);return !(h<100||h>10000)},g=function(h){if(!/^\d+$/i.test(h)){return false}h=Number(h);return !(h<1||h>12)};return{isDay:f,isYear:e,isMonth:g}};this._renderUI=function(){var h=this,e={},g,f=h.father.options;h.HTML="";e.prev="";e.next="";e.title="";e.ds="";if(!h.prevArrow){e.prev="hidden"}if(!h.nextArrow){e.next="hidden"}if(!h.father.showTime){e.showtime="hidden"}e.id=h.id="om-cal-"+Math.random().toString().replace(/.\./i,"");e.title=h.father._getHeadStr(h.year,h.month);h.createDS();e.ds=h.ds;h.father.con.append(h.father._templetShow(h.html,e));h.node=a("#"+h.id);if(f.showTime){g=h.node.find(".om-cal-ft");g.removeClass("hidden");h.timmer=new a.om.omCalendar.TimeSelector(g,h.father)}return this};this._buildEvent=function(){var h=this,f,e=a("#"+h.id),g=h.father.options;h.EV[0]=e.find("div.om-dbd").bind("mousedown",function(k){var m=a(k.target);if(m.filter(".om-null, .om-state-disabled").length>0){return}var j=Number(m.html());var l=new Date(g.date);l.setFullYear(h.year,h.month,j);h.father.dt_date=l;if(!g.showTime){h.father._trigger("onSelect",k,l)}if(g.popup&&!g.showTime){h.father.hide();if(!isNaN(h.father.dt_date)){var i=a.omCalendar.formatDate(h.father.dt_date,g.dateFormat||h.father._defaultFormat);a(h.father.element).val(i).focus().blur()}}h.father._render({date:l})}).find("a").bind("mouseover",function(i){a(this).addClass("om-state-hover om-state-nobd")}).bind("mouseout",function(i){a(this).removeClass("om-state-hover").not(".om-state-highlight, .om-state-active").removeClass("om-state-nobd")});h.EV[1]=e.find("a.om-prev").bind("click",function(i){h.father._monthMinus()._render();return false});h.EV[2]=e.find("a.om-next").bind("click",function(i){h.father._monthAdd()._render();return false});h.EV[3]=e.find("a.om-title").bind("click",function(j){try{h.timmer.hidePopup()}catch(k){}var l=a(j.target);var i=h.father._templetShow(h.nav_html,{the_month:h.month+1,the_year:h.year});e.find(".om-setime").html(i).removeClass("hidden").find("option:[value="+(h.month+1)+"]").attr("selected","selected");this.blur();e.find("input").bind("keydown",function(o){var p=a(o.target);if(o.keyCode==a.om.keyCode.UP){p.val(Number(p.val())+1);p[0].select()}if(o.keyCode==a.om.keyCode.DOWN){p.val(Number(p.val())-1);p[0].select()}if(o.keyCode==a.om.keyCode.ENTER){var n=e.find(".om-setime select").val();var m=e.find(".om-setime input").val();e.find(".om-setime").addClass("hidden");if(!h.Verify().isYear(m)){return}if(!h.Verify().isMonth(n)){return}h.father._render({date:h._computeDate(h,m,n)})}});return false}).bind("mouseover",function(i){a(this).addClass("om-state-hover")}).bind("mouseout",function(i){a(this).removeClass("om-state-hover")});h.EV[4]=e.find(".om-setime").bind("click",function(l){l.preventDefault();var m=a(l.target),k=a(this);if(m.hasClass("ok")){var j=k.find("select").val(),i=k.find("input").val();k.addClass("hidden");if(!h.Verify().isYear(i)){return}if(!h.Verify().isMonth(j)){return}j=j-k.parent().prevAll(".om-cal-box").length-1;h.father._render({date:h._computeDate(h,i,j)})}else{if(m.hasClass("cancel")){k.addClass("hidden")}}})};this._computeDate=function(h,f,g){var e=new Date(h.father.options.date.getTime());e.setFullYear(f,g);return e};this._getNode=function(){var e=this;return e.node};this._getNumOfDays=function(e,f){return 32-new Date(e,f-1,32).getDate()};this.createDS=function(){var g=this,m=g.father.options,o="",h=(new Date(g.year+"/"+(g.month+1)+"/01").getDay()+m.startDay+7)%7,j=g._getNumOfDays(g.year,g.month+1)+h,l,f;var e=[];for(l=0;l<m.disabledDays.length;l++){e[l]=m.disabledDays[l]%7}for(l=0;l<j;l++){var n=new Date(g.year+"/"+Number(g.month+1)+"/"+(l+1-h).toString());if(l<h){o+='<a href="javascript:void(0);" class="om-null" >0</a>'}else{if(a.inArray((l+m.startDay)%7,e)>=0){o+='<a href="javascript:void(0);" class="om-state-disabled">'+(l-h+1)+"</a>"}else{if(m.disabledFn(n)===false){o+='<a href="javascript:void(0);" class="om-state-disabled">'+(l-h+1)+"</a>"}else{if(m.minDate instanceof Date&&new Date(g.year+"/"+(g.month+1)+"/"+(l+1-h)).getTime()<(m.minDate.getTime()+1)){o+='<a href="javascript:void(0);" class="om-state-disabled">'+(l-h+1)+"</a>"}else{if(m.maxDate instanceof Date&&new Date(g.year+"/"+(g.month+1)+"/"+(l+1-h)).getTime()>m.maxDate.getTime()){o+='<a href="javascript:void(0);" class="om-state-disabled">'+(l-h+1)+"</a>"}else{if(l==(h+(new Date()).getDate()-1)&&(new Date()).getFullYear()==g.year&&(new Date()).getMonth()==g.month){o+='<a href="javascript:void(0);" class="om-state-highlight om-state-nobd">'+(l-h+1)+"</a>"}else{if(l==(h+m.date.getDate()-1)&&g.month==m.date.getMonth()&&g.year==m.date.getFullYear()){o+='<a href="javascript:void(0);" class="om-state-active om-state-nobd">'+(l-h+1)+"</a>"}else{o+='<a href="javascript:void(0);">'+(l-h+1)+"</a>"}}}}}}}}if(j%7!==0){for(l=0;l<(7-j%7);l++){o+='<a href="javascript:void(0);" class="om-null">0</a>'}}g.ds=o};this._render=function(){var e=this;e._renderUI();e._buildEvent()}}});a.extend(a.om.omCalendar,{TimeSelector:function(e,c){var b=c.options.date,d=a.om.lang.omCalendar;this.father=c;this.fcon=e.parent(".om-cal-box");this.popupannel=this.fcon.find(".om-selectime");if(typeof b=="undefined"){c.options.date=new Date()}this.time=c.options.date;this.status="s";this.ctime=a('<div class="om-cal-time om-state-default">'+d.time+'：<span class="h">h</span>:<span class="m">m</span>:<span class="s">s</span><!--{{arrow--><div class="cta"><button class="u om-icon om-icon-triangle-1-n"></button><button class="d om-icon om-icon-triangle-1-s"></button></div><!--arrow}}--></div>');this.button=a('<button class="ct-ok om-state-default">'+d.ok+"</button>");this.h_a=["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"];this.m_a=["00","10","20","30","40","50"];this.s_a=["00","10","20","30","40","50"];this.parseSubHtml=function(f){var h="";for(var g=0;g<f.length;g++){h+='<a href="javascript:void(0);" class="om-cal-item">'+f[g]+"</a>"}h+='<a href="javascript:void(0);" class="x">x</a>';return h};this.showPopup=function(g){var h=this;this.popupannel.html(g);this.popupannel.removeClass("hidden");var f=h.status;var i="om-state-active om-state-nobd";h.ctime.find("span").removeClass(i);switch(f){case"h":h.ctime.find(".h").addClass(i);break;case"m":h.ctime.find(".m").addClass(i);break;case"s":h.ctime.find(".s").addClass(i);break}};this.hidePopup=function(){this.popupannel.addClass("hidden")};this._render=function(){var g=this;var j=g.get("h");var f=g.get("m");var i=g.get("s");g.father._time=g.time;g.ctime.find(".h").html(j);g.ctime.find(".m").html(f);g.ctime.find(".s").html(i);return g};this.set=function(f,h){var g=this;h=Number(h);switch(f){case"h":g.time.setHours(h);break;case"m":g.time.setMinutes(h);break;case"s":g.time.setSeconds(h);break}g._render()};this.get=function(f){var g=this;var h=g.time;switch(f){case"h":return h.getHours();case"m":return h.getMinutes();case"s":return h.getSeconds()}};this.add=function(){var h=this;var f=h.status;var g=h.get(f);g++;h.set(f,g)};this.minus=function(){var h=this;var f=h.status;var g=h.get(f);g--;h.set(f,g)};this._timeInit=function(){var f=this;e.html("").append(f.ctime);e.append(f.button);f._render();f.popupannel.bind("click",function(i){var h=a(i.target);if(h.hasClass("x")){f.hidePopup()}else{if(h.hasClass("om-cal-item")){var g=Number(h.html());f.set(f.status,g);f.hidePopup()}}});f.button.bind("click",function(h){var j=f.father.options;var i=typeof f.father.dt_date=="undefined"?j.date:f.father.dt_date;i.setHours(f.get("h"));i.setMinutes(f.get("m"));i.setSeconds(f.get("s"));f.father._trigger("onSelect",h,i);if(j.popup){var g=a.omCalendar.formatDate(i,j.dateFormat||f.father._defaultFormat);a(f.father.element).val(g);f.father.hide()}});f.ctime.bind("keyup",function(g){if(g.keyCode==a.om.keyCode.UP||g.keyCode==a.om.keyCode.LEFT){g.preventDefault();f.add()}if(g.keyCode==a.om.keyCode.DOWN||g.keyCode==a.om.keyCode.RIGHT){g.preventDefault();f.minus()}});f.ctime.find(".u").bind("click",function(){f.hidePopup();f.add()});f.ctime.find(".d").bind("click",function(){f.hidePopup();f.minus()});f.ctime.find(".h").bind("click",function(){var g=f.parseSubHtml(f.h_a);f.status="h";f.showPopup(g)});f.ctime.find(".m").bind("click",function(){var g=f.parseSubHtml(f.m_a);f.status="m";f.showPopup(g)});f.ctime.find(".s").bind("click",function(){var g=f.parseSubHtml(f.s_a);f.status="s";f.showPopup(g)})};this._timeInit()}});a.omCalendar=a.omCalendar||{};a.extend(a.omCalendar,{leftPad:function(e,c,d){var b=new String(e);if(!d){d=" "}while(b.length<c){b=d+b}return b.toString()}});a.extend(a.omCalendar,{getShortDayName:function(b){return a.omCalendar.dayMaps[b][0]},getDayName:function(b){return a.omCalendar.dayMaps[b][1]},getShortMonthName:function(b){return a.omCalendar.monthMaps[b][0]},getMonthName:function(b){return a.omCalendar.monthMaps[b][1]},dayMaps:[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],monthMaps:[["Jan","January"],["Feb","February"],["Mar","March"],["Apr","April"],["May","May"],["Jun","June"],["Jul","July"],["Aug","August"],["Sep","September"],["Oct","October"],["Nov","November"],["Dec","December"]],formatCodes:{d:{g:"this.getDate()",s:"this.setDate({param})",r:"(0[1-9]|[1-2][0-9]|3[0-1]|[1-9])"},dd:{g:"$.omCalendar.leftPad(this.getDate(), 2, '0')",s:"this.setDate(parseInt('{param}', 10))",r:"(0[1-9]|[1-2][0-9]|3[0-1]|[1-9])"},m:{g:"(this.getMonth() + 1)",s:"this.setMonth(parseInt('{param}', 10) - 1)",r:"(0[1-9]|1[0-2]|[1-9])"},mm:{g:"$.omCalendar.leftPad(this.getMonth() + 1, 2, '0')",s:"this.setMonth(parseInt('{param}', 10) - 1)",r:"(0[1-9]|1[0-2]|[1-9])"},y:{g:"('' + this.getFullYear()).substring(2, 4)",s:"this.setFullYear(parseInt('20{param}', 10))",r:"(\\d{2})"},yy:{g:"this.getFullYear()",s:"this.setFullYear(parseInt('{param}', 10))",r:"(\\d{4})"},h:{g:"$.omCalendar.leftPad((this.getHours() % 12) ? this.getHours() % 12 : 12, 2, '0')",s:"this.setHours(parseInt('{param}', 10))",r:"(0[0-9]|1[0-1])"},H:{g:"$.omCalendar.leftPad(this.getHours(), 2, '0')",s:"this.setHours(parseInt('{param}', 10))",r:"([0-1][0-9]|2[0-3])"},g:{g:"((this.getHours() % 12) ? this.getHours() % 12 : 12)",s:"this.setHours(parseInt('{param}', 10))",r:"([0-9]|1[0-1])"},G:{g:"this.getHours()",s:"this.setHours(parseInt('{param}', 10))",r:"([0-9]|1[0-9]|2[0-3])"},i:{g:"$.omCalendar.leftPad(this.getMinutes(), 2, '0')",s:"this.setMinutes(parseInt('{param}', 10))",r:"([0-5][0-9])"},s:{g:"$.omCalendar.leftPad(this.getSeconds(), 2, '0')",s:"this.setSeconds(parseInt('{param}', 10))",r:"([0-5][0-9])"},u:{g:"$.omCalendar.leftPad(this.getMilliseconds(), 3, '0')",s:"this.setMilliseconds(parseInt('{param}', 10))",r:"(\\d{1,3})"},D:{g:"$.omCalendar.getShortDayName(this.getDay())",s:"",r:""},DD:{g:"$.omCalendar.getDayName(this.getDay())",s:"",r:""},M:{g:"$.omCalendar.getShortMonthName(this.getMonth())",s:"",r:""},MM:{g:"$.omCalendar.getMonthName(this.getMonth())",s:"",r:""},a:{g:"(this.getHours() < 12 ? 'am' : 'pm')",s:"",r:""},A:{g:"(this.getHours() < 12 ? 'AM' : 'PM')",s:"",r:""}}});a.extend(a.omCalendar,{formatDate:function(c,e){if(!c||!e){return null}if(!(Object.prototype.toString.call(c)==="[object Date]")){return null}var d,g,b="",f=false;for(d=0;d<e.length;d++){g=e.charAt(d);fi_next=e.charAt(d+1);if(g=="'"){f=!f;continue}if(!f&&a.omCalendar.formatCodes[g+fi_next]){g=new Function("return "+a.omCalendar.formatCodes[g+fi_next].g).call(c);d++}else{if(!f&&a.omCalendar.formatCodes[g]){g=new Function("return "+a.omCalendar.formatCodes[g].g).call(c)}}b+=g}return b},parseDate:function(g,j){if(!g||!j){return null}if(!(Object.prototype.toString.call(g)==="[object String]")){return null}var c=[],e,k,h=null,b;for(e=0;e<j.length;e++){k=j.charAt(e);fi_next=j.charAt(e+1);if(a.omCalendar.formatCodes[k+fi_next]){h=a.omCalendar.formatCodes[k+fi_next];e++}else{if(a.omCalendar.formatCodes[k]){h=a.omCalendar.formatCodes[k]}else{continue}}b=g.match(new RegExp(h.r));if(!b){return null}c.push(h.s.replace("{param}",b[0]));g=g.substring(b.index+b[0].length);var f=j.charAt(e+1);if(!(f==""&&g=="")&&(f!==g.charAt(0))&&(a.omCalendar.formatCodes[f]===undefined)){return null}}var d=new Date();new Function(c.join(";")).call(d);return d}});a.om.lang.omCalendar={year:"年",month:"月",Su:"日",Mo:"一",Tu:"二",We:"三",Th:"四",Fr:"五",Sa:"六",cancel:"取消",ok:"确定",time:"时间"}})(jQuery);
var om = {
	dataStore:{},
	parse:function(key){
		var setData = {
				"Button":{
					parseOptions:function(obj){
						var $obj = obj instanceof jQuery ? obj : $(obj);
						return {
							//图片是用地址放上去的，而不是css，不科学，待改进
							icons: {left:$obj.attr("iconLeft") || $obj.attr("iconCls"),right:$obj.attr("iconRight")}
						}
					}
				},
				"Calendar":{
					parseOptions:function(obj){
						var $obj = obj instanceof jQuery ? obj : $(obj);
						return {
						}
					}
				},
				"Combo":{
					parseOptions:function(obj){
						var $obj = obj instanceof jQuery ? obj : $(obj);
						return {
							value:$obj.val(),
							readOnly:/(readonly)|(true)/i.test($obj.attr("readOnly")) ? true : false,
							dataSource:$obj.attr("dataSource"),
							inputField:$obj.attr("inputField"),
							optionField:$obj.attr("optionField") || "text",
							valueField:$obj.attr("valueField") || "value"
						}
					}
				},
				"NumberField":{
					parseOptions:function(obj){
						var $obj = obj instanceof jQuery ? obj : $(obj);
						return {
							allowDecimals:/true/i.test($obj.attr("allowDecimals")) ? true : false,
							allowNegative:/true/i.test($obj.attr("allowNegative")) ? true : false,
							decimalPrecision:$obj.attr("decimalPrecision")
						}
					}
				},
				"Panel":{
					parseOptions:function(obj){
						var $obj = obj instanceof jQuery ? obj : $(obj);
						return {
							width:$obj.css('width'),
							height:$obj.css("height"),
							collapsed:$obj.attr("collapsed") == "true",
							collapsible:$obj.attr("collapsible") == "true" || $obj.attr("collapsed") == "true" || true
						}
					}
				},
				"Tabs":{
					parseOptions:function(obj){
						var $obj = obj instanceof jQuery ? obj : $(obj);
						return {
						}
					}
				}
			}
		return key ? setData[key] : setData;
		
	},
	omDocReady:function(){
		//$.om.omCombo.prototype.options.editable = false;
		$.extend($.om.omCombo.prototype.options,{ //改变下拉框的默认值
			forceSelection : true,
			filterDelay : 200,
			listMaxHeight : 200,
            inputField:"text",
            optionField:"text",
            valueField:"value"
		});
		$.om.omCalendar.prototype.options.editable = false;
			
		var sd = om.parse();
		$.each(sd,function(key,val){
			$(".oma-"+key).each(function(oid,odm){
				var $obj = $(odm);
				var conf = sd[key].parseOptions($obj);
				$obj["om"+key](conf);
			});
		})
	}
}

/*
 * 功能变更
 * $('#mycombo').omCombo('getText') 获得combo的文本

 * 
 * 
 */